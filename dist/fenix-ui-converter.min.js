!function(e,r){if("object"==typeof exports&&"object"==typeof module)module.exports=r(require("jquery"),require("underscore"),require("loglevel"),require("handlebars"));else if("function"==typeof define&&define.amd)define(["jquery","underscore","loglevel","handlebars"],r);else{var t="object"==typeof exports?r(require("jquery"),require("underscore"),require("loglevel"),require("handlebars")):r(e.jquery,e.underscore,e.loglevel,e.handlebars);for(var o in t)("object"==typeof exports?exports:e)[o]=t[o]}}(this,function(e,r,t,o){return function(e){function r(o){if(t[o])return t[o].exports;var n=t[o]={exports:{},id:o,loaded:!1};return e[o].call(n.exports,n,n.exports,r),n.loaded=!0,n.exports}var t={};return r.m=e,r.c=t,r.p="",r(0)}([function(e,r,t){e.exports=t(1)},function(e,r,t){var o,n;o=[t(2),t(3),t(4),t(5)],n=function(e,r,t,o){"use strict";function n(){return this}return n.prototype.toD3P=function(o,n){var i={},u=this;return r.each(n.values,function(r,n){var a=u.cleanArray(r),c=o[n]||{},s=c.format||{},l=s.items||n;a.length>0?i[l]=e.extend(!0,{},u.compileFilter(n,a,o)):t.warn(n+" column excluded from FENIX conversion because it has no values")}),i},n.prototype.toFilter=function(o,n){var i={},u=this;return r.each(n.values,function(r,n){var a=u.cleanArray(r),c=o[n]||{},s=c.format||{},l=s.metadataAttribute;return l?void(a.length>0?i[l]=e.extend(!0,{},u.compileFilter(n,a,o)):t.warn(n+" column excluded from FENIX filter because it has no values")):void t.warn(n+" impossible to find format.metadataAttribute configuration")}),i},n.prototype.compileFilter=function(e,r,o){var n=o[e]||{},i=n.format||{},u=i.template,a=i.output||"codes";if(u)return this.compileTemplate(e,r,n,u);var c,s=i.dimension||e;switch(a.toLocaleLowerCase()){case"codes":return c='{ "codes":[{"uid": "{{{uid}}}", "version": "{{version}}", "codes": [{{{codes}}}] } ]}',this.compileTemplate(e,r,n,s,c);case"time":return this.createTimeFilter(e,r,n,s);case"enumeration":return this.createEnumerationFilter(e,r,n,s);default:return t.warn(e+" not included in the result set. Missing format configuration."),{}}},n.prototype.compileTemplate=function(n,i,u,a,c){var s=e.extend(!0,u.cl,u.format,{codes:'"'+i.join('","')+'"'});if(c||t.error("Impossible to find '"+n+"' process template. Check your '"+n+"'.filter.process configuration."),!s.uid)return void t.error("Impossible to find '"+n+"' code list configuration for FENIX output format export.");var l=o.compile(c),f=JSON.parse(l(s)),p=f.codes;return r.each(p,function(e){e.version||delete e.version}),f},n.prototype.createTimeFilter=function(t,o,n,i){var u,a=[],c="object"==typeof o[0];if(c){var s=r.findWhere(o,{parent:"from"})||{},l=r.findWhere(o,{parent:"to"})||{},f={from:null,to:null};f.from=s.value,f.to=l.value,a.push(e.extend({},f))}else u=o.map(function(e){return parseInt(e,10)}).sort(function(e,r){return e-r}),r.each(u,function(e){a.push({from:e,to:e})});return{time:a}},n.prototype.createEnumerationFilter=function(e,r,t,o){return{enumeration:r}},n.prototype.cleanArray=function(e){for(var r=[],t=0;t<e.length;t++)e[t]&&r.push(e[t]);return r},new n}.apply(r,o),!(void 0!==n&&(e.exports=n))},function(r,t){r.exports=e},function(e,t){e.exports=r},function(e,r){e.exports=t},function(e,r){e.exports=o}])});